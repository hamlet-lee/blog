# Kudu installation with Docker

  * 参考：https://github.com/kunickiaj/kudu-docker
  * 版本：kudu 1.4.0-cdh5.12.2
  
  ## 方案1：docker-compose 能启动，但不会用
  ```shell
  $ git clone https://github.com/kunickiaj/kudu-docker.git
  $ cd kudu-docker
  
  
  $ yum install docker-compose
  $ docker-compose up -d
  
  # 参考：www.remotecto.net/2017/02/08/docker-error-response-daemon-cannot-link-compose_mysql_1-not-belong-default-network/
  $ docker network ls
  
  NETWORK ID          NAME                 DRIVER              SCOPE
44dcf95a9a80        bridge               bridge              local
d45ab37ffc07        host                 host                local
06b0405bc212        kududocker_default   bridge              local
9da432a3a4d9        none                 null                local

  $ docker run --rm -it --link kududocker_kudu-tserver_1:kudu_tserver --net kududocker_default -e KUDU_TSERVER=kudu_tserver kunickiaj/kudu 
  ```
  # 方案2：docker 启动两个
  
  ```shell
  $ docker run -d --name kudu-master -p 8051:8051 kunickiaj/kudu master
  $ docker run -d --name kudu-tserver -p 8050:8050 --link kudu-master -e KUDU_MASTER=kudu-master kunickiaj/kudu tserver
  ```
  
  可以访问： 
   * TabletServer: http://外网ip:8050/
   * Master:  http://外网ip:8051/
 
 
 另一个可以尝试的：impala - kudu
 https://hub.docker.com/r/parrotstream/impala-kudu



# Presto with Docker
* 参考：https://hub.docker.com/r/skame/presto
* 参考：https://github.com/skame/docker-presto/blob/master/Dockerfile

 ```shell
 $ docker run -d --name presto -p 8080 --link kudu-master skame/presto:latest
 ```
 
 ```shell
 $ docker container ls -a | grep presto
0d774335fcb1        skame/presto:latest             "/opt/presto/bin/lau??   5 minutes ago       Exited (4) 5 minutes ago                                                       presto
```
 可见启动失败
 
 查看日志
 
 ```shell
 $ docker logs presto
 ERROR: Config file is missing: /opt/presto/etc/config.properties
 ```
 
 重来
 ```shell
 $ docker container rm presto
 ```
 准备配置文件, 目录： /root/presto/etc/
 
 node.properties
 
 ```properties
 node.environment=production
 node.id=ffffffff-ffff-ffff-ffff-ffffffffffff
 node.data-dir=/var/presto/data
 ```
 
 jvm.config
 
 ```properties
 -server
-Xmx1500m
-XX:+UseG1GC
-XX:G1HeapRegionSize=32M
-XX:+UseGCOverheadLimit
-XX:+ExplicitGCInvokesConcurrent
-XX:+HeapDumpOnOutOfMemoryError
-XX:+ExitOnOutOfMemoryError
```
config.properties
```properties
coordinator=true
node-scheduler.include-coordinator=true
http-server.http.port=8080
query.max-memory=500MB
query.max-memory-per-node=500MB
query.max-total-memory-per-node=1GB
discovery-server.enabled=true
discovery.uri=http://localhost:8080
```
 
 ```
 $ docker run -d --name presto -p 8080:8080 --link kudu-master -v /root/presto/etc:/opt/presto/etc skame/presto:latest
 $ docker logs --tail 4  presto
2019-03-17T06:33:07.333Z	INFO	main	com.facebook.presto.server.PluginManager	-- Finished loading plugin /var/presto/data/plugin/tpch --
2019-03-17T06:33:07.348Z	INFO	main	com.facebook.presto.security.AccessControlManager	-- Loading system access control --
2019-03-17T06:33:07.349Z	INFO	main	com.facebook.presto.security.AccessControlManager	-- Loaded system access control allow-all --
2019-03-17T06:33:07.429Z	INFO	main	com.facebook.presto.server.PrestoServer	======== SERVER STARTED ========
 ```
 
 # run Presto Client with docker
 ```
 $ docker run --rm  -it --link presto harisekhon/presto-cli-dev --server presto:8080
 ```
 
 # run Docker container 换启动命令
  * https://oprea.rocks/blog/how-to-properly-override-the-entrypoint-using-docker-run/
  
 
 # 进入一个running container
 https://askubuntu.com/questions/505506/how-to-get-bash-or-ssh-into-a-running-container-in-background-mode
 ```shell
 $ docker exec -i -t loving_heisenberg /bin/bash
 ```
 
 # 给已有container增加volume
 参考： https://stackoverflow.com/questions/28302178/how-can-i-add-a-volume-to-an-existing-docker-container
 
 ```
 $ docker ps  -a
CONTAINER ID        IMAGE                 COMMAND                  CREATED              STATUS                          PORTS               NAMES
    5a8f89adeead        ubuntu:14.04          "/bin/bash"              About a minute ago   Exited (0) About a minute ago                       agitated_newton

$ docker commit 5a8f89adeead newimagename

$ docker run -ti -v "$PWD/dir1":/dir1 -v "$PWD/dir2":/dir2 newimagename /bin/bash
```
 
