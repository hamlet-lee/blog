# Spring Boot 的 @Scheduled 的坑
多个 @Scheduled 貌似是共享同一个线程，如果某个Throw了exception貌似会导致其他的也不能正常执行了???

```java
@Scheduled(initialDelay = 5000,fixedRate=60000)
void smsSender() throws Exception
{
  LOG.info("smsSenderLock acquiring...");
  smsSenderLock.acquire();
  LOG.info("smsSenderLock acquired");
}

@Scheduled(initialDelay = 5000,fixedRate=60000)
void processAlarms() throws Exception {
  LOG.info("try to acquire alarm processor lock...");
  processLock.acquire();
  LOG.info("alarm processor lock acquired");
}

@Scheduled(cron = "0 * * * * *")
private void reloadData(){
   LOG.info("reload xxx data ...");
   ...
}
```


```text
2019-07-09 12:05:10.072  INFO 552 --- [   scheduling-1] a.web.handler.misc.AlarmController       : try to acquire alarm processor lock...
2019-07-09 12:07:03.078  INFO 552 --- [   scheduling-1] AlarmController       : alarm processor lock acquired
2019-07-09 12:07:28.333  INFO 552 --- [   scheduling-1] AlarmController       : smsSenderLock acquired
2019-07-09 12:07:29.094  INFO 552 --- [   scheduling-1] AlarmController       : try to acquire alarm processor lock...
2019-07-09 12:09:23.768  INFO 552 --- [   scheduling-1] AlarmController       : alarm processor lock acquired
2019-07-09 12:09:47.496  INFO 552 --- [   scheduling-1] AlarmController       : smsSenderLock acquired
2019-07-09 12:09:48.308  INFO 552 --- [   scheduling-1] AlarmController       : try to acquire alarm processor lock...
2019-07-09 12:11:42.854  INFO 552 --- [   scheduling-1] AlarmController       : alarm processor lock acquired
2019-07-09 12:12:06.107  INFO 552 --- [   scheduling-1] AlarmController       : smsSenderLock acquired   -- 这里acquired了，下面另一个scheduled才能执行???
2019-07-09 12:12:06.939  INFO 552 --- [   scheduling-1] AccessControl  : reload xxx data ...
2019-07-09 12:12:06.946  INFO 552 --- [   scheduling-1] AlarmController       : try to acquire alarm processor lock...
```

* 参考： https://stackoverflow.com/questions/21993464/does-spring-scheduled-annotated-methods-runs-on-different-threads  
这里说，需要配置pool-size的属性，否则只有单个线程来运行scheduled task

然后引用了这个 https://docs.spring.io/spring/docs/current/spring-framework-reference/integration.html#scheduling

可以继续看看Spring Boot官方文档  
https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#boot-features-quartz

这里说了相关配置
```properties
# TASK SCHEDULING  (TaskSchedulingProperties)
spring.task.scheduling.pool.size=1 # Maximum allowed number of threads.
spring.task.scheduling.thread-name-prefix=scheduling- # Prefix to use for the names of newly created threads.
```
在代码里搜索，发现 
```json
    {
      "name": "spring.task.scheduling.pool.size",
      "type": "java.lang.Integer",
      "description": "Maximum allowed number of threads.",
      "sourceType": "org.springframework.boot.autoconfigure.task.TaskSchedulingProperties$Pool",
      "defaultValue": 1
    },
    {
      "name": "spring.task.scheduling.thread-name-prefix",
      "type": "java.lang.String",
      "description": "Prefix to use for the names of newly created threads.",
      "sourceType": "org.springframework.boot.autoconfigure.task.TaskSchedulingProperties",
      "defaultValue": "scheduling-"
    },

```
