# 部署一个HiveServer，用于测试自定义的SerDe代码
1. rsync 到测试机器  
   参考脚本 rsync_hive.sh
   ```shell
    #!/bin/sh
    export TO_HOST=$1
    if [ "" == "$TO_HOST" ]; then
      echo "args: <TO_HOST>"
      exit 1
    fi

    rsync -avP hadoop-2.7.2 jdk1.8.0_144 jdk1.8.0_40 apache-tez-0.8.4-bin apache-hive-2.3.0-bin --exclude=*/logs/* --exclude=*/log/* --exclude=*/tmp/* $TO_HOST:`pwd`

   ```
1. 调整配置，服务不进入ha集群  
   相关配置可以参考
   ```xml
     <property>
       <name>hive.server2.support.dynamic.service.discovery</name>
       <value>false</value>
       <description>Whether HiveServer2 supports dynamic service discovery for its clients. To support this, each instance of HiveServer2 currently uses ZooKeeper to register itself, when it is brought up. JDBC/ODBC clients should use the ZooKeeper ensemble: hive.zookeeper.quorum in their connection string.</description>
     </property>
   ```
1. 启动脚本参考  bin/start_hiveserver.sh
   ```shell
   #!/bin/sh
   export TEZ_CONF_DIR=/path/to/apache-tez-0.8.4-bin/conf
   export TEZ_JARS=/path/to/apache-tez-0.8.4-bin
   export HADOOP_CLASSPATH=${TEZ_CONF_DIR}:${TEZ_JARS}/*:${TEZ_JARS}/lib/*:
   export HIVE_DEBUG_PORT=12333
   export HIVE_DEBUG="-Xdebug -Xrunjdwp:transport=dt_socket,address=${HIVE_DEBUG_PORT},server=y,suspend=n"
   #export HADOOP_CLIENT_OPTS="-Xmx2000m"


   export HIVE_AUX_JARS_PATH=/global/home/analysis/hadoop-4mc-2.0.0-2.0.0.jar:/disk1/eadop/apache-hive-2.3.0-bin/hcatalog/share/hcatalog/hive-hcatalog-core-2.3.0.jar:这里加上自己开发的SerDe和相关的依赖jar
   
   # 带调试启动，放到后台
   nohup bin/hiveserver2 --debug 2>&1 1>log/hiveserver2.log &
   
   # 带调试启动，在前台
   # bin/hiveserver2 --debug 
   ```

1. 启动后，标准输入输出只有少量日志。更多日志见： /path/to/apache-hive-2.3.0-bin/tmp/${USER}/hive.log

1. Beeline 的 启动脚本  
   参考：xxx_hive.sh
   ```shell
   #!/bin/sh
   echo JAVA_HOME=$JAVA_HOME
   echo PATH=$PATH
   echo CLASSPATH=$CLASSPATH
   echo HADOOP_CLASSPATH=$HADOOP_CLASSPATH
   echo HADOOP_HOME=$HADOOP_HOME
   echo HADOOP_OPTS=$HADOOP_OPTS

   export HIVE_HOME=/path/to/shared/apache-hive-2.3.0-bin
   pushd /path/to/shared/apache-hive-2.3.0-bin
   bin/start_beeline_xxx.sh $*

   ```
   

1. Beeline 的 内层启动脚本  
   参考：/path/to/shared/apache-hive-2.3.0-bin/bin/start_beeline_xxx.sh
   ```shell
   #!/bin/sh
   if [ "$HIVE_USER" == "" ]; then
     export HIVE_USER=`whoami`
   fi
   bin/beeline -u jdbc:hive2://${YOUR_HIVESERVER_HOST}:${YOUR_HIVESERVER_PORT} -n $HIVE_USER $*
   ```  
   这里的 ${YOUR_HIVESERVER_PORT} 由hive-site.xml里面的  
   ```xml
     <property>
       <name>hive.server2.thrift.port</name>
       <value>10000</value>
       <description>Port number of HiveServer2 Thrift interface when hive.server2.transport.mode is 'binary'.</description>
     </property>
   ```
   定义
