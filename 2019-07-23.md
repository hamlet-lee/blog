# IP地址库合并算法设计
## 背景
为了提高ip地址解析的覆盖率，我们可能希望综合多个ip地址库的结果。如果逐个在线查询，会影响性能，并浪费存储。因此可以考虑将多个ip地址库按照预定的逻辑进行合并。  

## ip地址库的格式
ip地址库的格式通常类似如下：  
  ```text
  startIp1,endIp1,country1,province1,city1,operator1
  startIp2,endIp2,country2,province2,city2,operator2
  ...
  ```  
  其中 [startIp,endIp] 是一个地址闭区间，country、province、city、operator 是这个地址区间内ip的一些属性。  
  通常，这个文件中各行的 [startIp,endIp] 闭区间是不相交的，并且是已经按照 startIp 做升序排序的。
  country、province、city、operator 这些属性有可能会缺失，例如：  
```text
country=中国 province=未知 city=未知 operator=中国移动
```

## 合并的示例

不同的ip地址库之间，可能有能够互相补充的字段。例如（对于某个ip）:
```text
ip地址库1：  country=中国 province=未知 city=未知 operator=中国移动
ip地址库2：  country=中国 province=广东 city=广州 operator=未知
```
这时，如果合并两个地址库的结果，就可以获得更大的覆盖率。

## 合并算法
总体设计：分三步完成，  
* 第一步，将ip地址段按照各个库的ip地址段覆盖情况拆分；拆分出来的每一段地址关联到各个库中相应的信息；
* 第二步，对拆分出来的地址段逐一执行合并规则，生成合并中间结果
* 第三步，对中间结果进行ip地址段合并，即如果存在连续的多个ip地址段对应到相同的内容，则进行合并


