# 尝试解决DNS问题
1. 怀疑docker-compose内部的DNS服务的IP地址与外部IP地址冲突
container内部：
```shell
cat /etc/resolv.conf
nameserver 127.0.0.11
options ndots:0
```
搜索这个 127.0.0.11 以及 resolve，找到 [Docker Embedded DNS](https://www.jianshu.com/p/4433f4c70cf0)

> 不为default, bridge, host, none, container时，则认为是用户定义网络，进而enable了embedded DNS。  
/etc/resolv.conf文件，将servername指向127.0.0.11。（127.0.0.0/8网段都是loopback地址）

> 将之前读取的容器初始/etc/resolv.conf文件的nameserver作为embedded DNS的recursive DNS，当embedded DNS不能resolve name的时候就delegate到extDNS。

> r.setupIPTable()添加iptables规则将127.0.0.11:53的name resolution query通过DNAT转发到127.0.0.11:tcp_port或127.0.0.11:udp_port（DNS query默认是udp，效率高）。将出去的query通过SNAT转换回127.0.0.11:53。

https://baike.baidu.com/item/loopback/2779210
> 回环网卡（Loopback adaptor），是一种特殊的网络接口，不与任何实际设备连接，而是完全由软件实现。与回环地址（127.0.0.0/8 或::1/128）不同，回环网卡对系统“显示”为一块硬件。任何发送到该网卡上的数据都将立刻被同一网卡接收到。例子有Linux下的 lo 接口和Windows下的 Microsoft Loopback Interface 网卡。

iptables 代理的工作方式： [iptables详解](https://www.cnblogs.com/metoy/p/4320813.html)

