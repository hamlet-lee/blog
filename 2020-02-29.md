# OPENVPN 访问 Docker-compose 网络
* https://github.com/kylemanna/docker-openvpn/blob/master/docs/docker-compose.md
* 虚拟机设置 forward (不一定需要)
* 去掉 vpnclient ovpn 文件中最后一行，并增加压缩配置
  ```
  # 增加
  comp-lzo
  
  # 去掉
  # redirect-gateway def1
  ```
  

* Server 配置：openvpn-data/conf/openvpn.conf
  * 去掉 末尾的dns相关
  ```
  # push "block-outside-dns"
  # push "dhcp-option DNS 8.8.8.8"
  # push "dhcp-option DNS 8.8.4.4"
  ```

* 外部windows机器使用 route print, route add 配置需要的路由


## 如果 openvpn client 不去掉 redirect-gateway def1，会导致 route 如下
```
IPv4 路由表
===========================================================================
活动路由:
网络目标        网络掩码          网关       接口   跃点数
          0.0.0.0          0.0.0.0     192.168.31.1   192.168.31.222     55
          0.0.0.0        128.0.0.0    192.168.255.5    192.168.255.6     35
        127.0.0.0        255.0.0.0            在链路上         127.0.0.1    331
        127.0.0.1  255.255.255.255            在链路上         127.0.0.1    331
  127.255.255.255  255.255.255.255            在链路上         127.0.0.1    331
        128.0.0.0        128.0.0.0    192.168.255.5    192.168.255.6     35
     192.168.31.0    255.255.255.0            在链路上    192.168.31.222    311
   192.168.31.222  255.255.255.255            在链路上    192.168.31.222    311
   192.168.31.255  255.255.255.255            在链路上    192.168.31.222    311
     192.168.56.0    255.255.255.0            在链路上      192.168.56.1    281
     192.168.56.1  255.255.255.255            在链路上      192.168.56.1    281
   192.168.56.101  255.255.255.255     192.168.31.1   192.168.31.222     55
   192.168.56.255  255.255.255.255            在链路上      192.168.56.1    281
    192.168.255.1  255.255.255.255    192.168.255.5    192.168.255.6     35
    192.168.255.4  255.255.255.252            在链路上     192.168.255.6    291
    192.168.255.6  255.255.255.255            在链路上     192.168.255.6    291
    192.168.255.7  255.255.255.255            在链路上     192.168.255.6    291
        224.0.0.0        240.0.0.0            在链路上     192.168.255.6    291
  255.255.255.255  255.255.255.255            在链路上     192.168.255.6    291
===========================================================================
```

很大一个网段都会被路由到vpn网关。


## 服务端推送一些网段走 VPN
```
#push “redirect-gateway def1 bypass-dhcp”注释该段
push "route 192.168.0.0 255.255.255.0"#服务器让客户端推送一些常用的地址段
```
