# 学习Cassandra - where语句的限制
```
cassandra@cqlsh:cycling> CREATE TABLE rank_by_year_and_name (
           ... race_year int,
           ... race_name text,
           ... cyclist_name text,
           ... rank int,
           ... PRIMARY KEY ((race_year, race_name), rank)
           ... );
cassandra@cqlsh:cycling> select * from rank_by_year_and_name ;

 race_year | race_name | rank | cyclist_name
-----------+-----------+------+--------------

(0 rows)

-- 默认是不允许只过滤部分partition key的？
cassandra@cqlsh:cycling> select * from rank_by_year_and_name where race_year = 111;
InvalidRequest: Error from server: code=2200 [Invalid query] message="Cannot execute this query as it might involve data filtering and thus may have unpredictable performance. If you want to execute this query despite the performance unpredictability, use ALLOW FILTERING"

-- 对race_name也做限制
cassandra@cqlsh:cycling> select * from rank_by_year_and_name where race_year = 111 and race_name = 'xxx';

 race_year | race_name | rank | cyclist_name
-----------+-----------+------+--------------

(0 rows)
```

# 学习Cassandra - update 不需要数据行已经存在
```
cassandra@cqlsh:cycling> INSERT INTO cycling.cyclist_name (id, lastname, firstname) VALUES (5b6962dd-3f90-4c93-8f61-eabfa4a803e2, 'VOS','Marianne');
cassandra@cqlsh:cycling> select * from cycli
cycling.           cyclist_alt_stats  cyclist_name
cassandra@cqlsh:cycling> select * from cycling.cyclist_name;

 id                                   | firstname | lastname
--------------------------------------+-----------+----------
 5b6962dd-3f90-4c93-8f61-eabfa4a803e2 |  Marianne |      VOS

(1 rows)

-- id 是 UUID 格式，所以 'xx' 和 xx 是不合法的
cassandra@cqlsh:cycling> update  cycling.cyclist_name set lastname = 'xx' where id = 'xx';
InvalidRequest: Error from server: code=2200 [Invalid query] message="Invalid STRING constant (xx) for "id" of type uuid"
cassandra@cqlsh:cycling> update  cycling.cyclist_name set lastname = 'xx' where id = xx;
SyntaxException: line 1:62 no viable alternative at input ';' (...= 'xx' where id = [xx];)

-- 尝试一个不存在的合法的 UUID
cassandra@cqlsh:cycling> update  cycling.cyclist_name set lastname = 'xx' where id = 5b6962dd-3f90-4c93-8f61-eabfa4a803e1;

-- 竟然直接成功了！
cassandra@cqlsh:cycling> select * from cycling.cyclist_name;

 
 id                                   | firstname | lastname
--------------------------------------+-----------+----------
 5b6962dd-3f90-4c93-8f61-eabfa4a803e2 |  Marianne |      VOS
 5b6962dd-3f90-4c93-8f61-eabfa4a803e1 |      null |       xx
 ```
 

# 学习Cassandra - TTL
```
-- update 不支持 ttl
cassandra@cqlsh:cycling> update  cycling.cyclist_name set lastname = 'xx' where id = 5b6962dd-3f90-4c93-8f61-eabfa4a803e4 using ttl 100;
SyntaxException: line 1:97 mismatched input 'using' expecting EOF (...'xx' where id = 5b6962dd-3f90-4c93-8f61-eabfa4a803e4 [using]...)

-- insert 支持 ttl
cassandra@cqlsh:cycling> INSERT INTO cycling.cyclist_name (id, lastname, firstname) VALUES (5b6962dd-3f90-4c93-8f61-eabfa4a803e0, 'VOSttl','Mariannettl') using ttl 100;

-- 查看ttl
cassandra@cqlsh:cycling> select ttl(lastname) from cycling.cyclist_name;

 ttl(lastname)
---------------
            95
          null
          null

(3 rows)
-- 查看数据
cassandra@cqlsh:cycling> select * from cycling.cyclist_name;

 id                                   | firstname   | lastname
--------------------------------------+-------------+----------
 5b6962dd-3f90-4c93-8f61-eabfa4a803e0 | Mariannettl |   VOSttl
 5b6962dd-3f90-4c93-8f61-eabfa4a803e2 |    Marianne |      VOS
 5b6962dd-3f90-4c93-8f61-eabfa4a803e1 |        null |       xx

-- 等待一段时间后
cassandra@cqlsh:cycling> select * from cycling.cyclist_name;

 id                                   | firstname | lastname
--------------------------------------+-----------+----------
 5b6962dd-3f90-4c93-8f61-eabfa4a803e2 |  Marianne |      VOS
 5b6962dd-3f90-4c93-8f61-eabfa4a803e1 |      null |       xx
```
