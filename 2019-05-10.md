# 调研Presto Gateway
网址：https://github.com/lyft/presto-gateway  
调研计划：
## 运行起来，试试CLI方式能不能正常工作  
 直接mvn install 报错。删除掉pom.xml中checkstyle相关的plugin之后，能够正常build  
 配置文件 gateway/src/main/resources/config.yml.test  
  ```yaml
  requestRouter:
    port: 23142
    name: Proxly
    cacheDir: log/prestoproxy/cache
    historySize: 1000

  backends:
    - localPort: 23143
      name: presto1
      proxyTo: http://hd012:28286

    - localPort: 23144
      name: presto2
      proxyTo: http://hd020:28286

  server:
    applicationConnectors:
      - type: http
        port: 23145
    adminConnectors:
      - type: http
        port: 23146

  notifier:
    smtpHost: soda.rd.netease.com
    smtpPort: 25
    sender: postmaster@rd.netease.com
    recipients:
      - lisn@rd.netease.com

  modules:
    - com.lyft.data.gateway.module.ProxyBackendProviderModule
    - com.lyft.data.gateway.module.GatewayProviderModule
    - com.lyft.data.gateway.module.NotifierModule

  managedApps:
    - com.lyft.data.gateway.GatewayManagedApp
    - com.lyft.data.gateway.ActiveClusterMonitor

  # Logging settings.
  logging:
    # The default level of all loggers. Can be OFF, ERROR, WARN, INFO, DEBUG, TRACE, or ALL.
    level: INFO

    # Logger-specific levels.
    loggers:
      com.lyft: DEBUG

    appenders:
      - type: console
      - type: file
        currentLogFilename: log/prestoproxy/prestoproxy-java.log
        archivedLogFilenamePattern: log/prestoproxy/prestoproxy-java-%d{yyyy-MM-dd}-%i.log.gz
        archivedFileCount: 7
        timeZone: UTC
        maxFileSize: 100MB

  ```  
  CLI能够正常工作
## 检查其它API，例如当前查询列表的API是否正常
## 检查jdbc方式连接是否正常
## 检查长时间查询是否正常
## 配置多个presto集群，看是否有load balance效果
## 找到可以插入路由规则的地方

# 检查Kafka Topic的脚本
~/check.sh 
```shell
#!/bin/sh
export TOPIC=$1
echo 
echo ========== $TOPIC ==========
echo 
/path/to/kafka_2.11-0.10.0.0/bin/kafka-console-consumer.sh --zookeeper zk1:2185,zk2:2185,zk3:2185 --from-beginning --max-messages 10000 --topic $TOPIC | grep Processed
```
